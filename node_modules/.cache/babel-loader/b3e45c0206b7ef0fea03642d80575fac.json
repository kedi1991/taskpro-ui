{"ast":null,"code":"var _jsxFileName = \"/workspace/taskpro_api/taskpro_ui/src/contexts/ActiveUserContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\n/**\n * Code duplicated from https://github.com/mr-fibonacci/moments/blob/a981c39da1671a70023a3d6f3cf1410164e84e06/src/contexts/CurrentUserContext.js \n */\nimport { createContext, useContext, useEffect, useMemo, useState } from \"react\";\nimport axios from \"axios\";\nimport { axiosReq, axiosRes } from \"../api/axiosDefaults\";\nimport { useHistory } from \"react-router\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const ActiveUserContext = /*#__PURE__*/createContext();\nexport const SetActiveUserContext = /*#__PURE__*/createContext();\nexport const useActiveUser = () => {\n  _s();\n  return useContext(ActiveUserContext);\n};\n_s(useActiveUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const useSetActiveUser = () => {\n  _s2();\n  return useContext(SetActiveUserContext);\n};\n_s2(useSetActiveUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const ActiveUserProvider = ({\n  children\n}) => {\n  _s3();\n  const [activeUser, setActiveUser] = useState(null);\n  const history = useHistory();\n  const handleMount = async () => {\n    try {\n      const {\n        data\n      } = await axiosRes.get(\"dj-rest-auth/user/\");\n      setActiveUser(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  useEffect(() => {\n    handleMount();\n  }, []);\n  useMemo(() => {\n    axiosReq.interceptors.request.use(async config => {\n      try {\n        await axios.post(\"/dj-rest-auth/token/refresh/\");\n      } catch (err) {\n        setActiveUser(prevActiveUser => {\n          if (prevActiveUser) {\n            history.push(\"/signin\");\n          }\n          return null;\n        });\n        return config;\n      }\n      return config;\n    }, err => {\n      return Promise.reject(err);\n    });\n    axiosRes.interceptors.response.use(response => response, async err => {\n      var _err$response;\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n        try {\n          await axios.post(\"/dj-rest-auth/token/refresh/\");\n        } catch (err) {\n          setActiveUser(prevActiveUser => {\n            if (prevActiveUser) {\n              history.push(\"/signin\");\n            }\n            return null;\n          });\n        }\n        return axios(err.config);\n      }\n      return Promise.reject(err);\n    });\n  }, [history]);\n  return /*#__PURE__*/_jsxDEV(ActiveUserContext.Provider, {\n    value: activeUser,\n    children: /*#__PURE__*/_jsxDEV(SetActiveUserContext.Provider, {\n      value: setActiveUser,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this);\n};\n_s3(ActiveUserProvider, \"9ivM73VfpBbuR/2J73d7SXBZoZY=\", false, function () {\n  return [useHistory];\n});\n_c = ActiveUserProvider;\nvar _c;\n$RefreshReg$(_c, \"ActiveUserProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","axios","axiosReq","axiosRes","useHistory","jsxDEV","_jsxDEV","ActiveUserContext","SetActiveUserContext","useActiveUser","_s","useSetActiveUser","_s2","ActiveUserProvider","children","_s3","activeUser","setActiveUser","history","handleMount","data","get","err","console","log","interceptors","request","use","config","post","prevActiveUser","push","Promise","reject","response","_err$response","status","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/workspace/taskpro_api/taskpro_ui/src/contexts/ActiveUserContext.js"],"sourcesContent":["/**\n * Code duplicated from https://github.com/mr-fibonacci/moments/blob/a981c39da1671a70023a3d6f3cf1410164e84e06/src/contexts/CurrentUserContext.js \n */\nimport { createContext, useContext, useEffect, useMemo, useState } from \"react\";\nimport axios from \"axios\";\nimport { axiosReq, axiosRes } from \"../api/axiosDefaults\";\nimport { useHistory } from \"react-router\";\n\nexport const ActiveUserContext = createContext();\nexport const SetActiveUserContext = createContext();\n\nexport const useActiveUser = () => useContext(ActiveUserContext);\nexport const useSetActiveUser = () => useContext(SetActiveUserContext);\n\nexport const ActiveUserProvider = ({ children }) => {\n  const [activeUser, setActiveUser] = useState(null);\n  const history = useHistory();\n\n  const handleMount = async () => {\n    try {\n      const { data } = await axiosRes.get(\"dj-rest-auth/user/\");\n      setActiveUser(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  useEffect(() => {\n    handleMount();\n  }, []);\n\n  useMemo(() => {\n    axiosReq.interceptors.request.use(\n      async (config) => {\n        try {\n          await axios.post(\"/dj-rest-auth/token/refresh/\");\n        } catch (err) {\n          setActiveUser((prevActiveUser) => {\n            if (prevActiveUser) {\n              history.push(\"/signin\");\n            }\n            return null;\n          });\n          return config;\n        }\n        return config;\n      },\n      (err) => {\n        return Promise.reject(err);\n      }\n    );\n\n    axiosRes.interceptors.response.use(\n      (response) => response,\n      async (err) => {\n        if (err.response?.status === 401) {\n          try {\n            await axios.post(\"/dj-rest-auth/token/refresh/\");\n          } catch (err) {\n            setActiveUser((prevActiveUser) => {\n              if (prevActiveUser) {\n                history.push(\"/signin\");\n              }\n              return null;\n            });\n          }\n          return axios(err.config);\n        }\n        return Promise.reject(err);\n      }\n    );\n  }, [history]);\n\n  return (\n    <ActiveUserContext.Provider value={activeUser}>\n      <SetActiveUserContext.Provider value={setActiveUser}>\n        {children}\n      </SetActiveUserContext.Provider>\n    </ActiveUserContext.Provider>\n  );\n};"],"mappings":";;;;AAAA;AACA;AACA;AACA,SAASA,aAAa,EAAEC,UAAU,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AAC/E,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,EAAEC,QAAQ,QAAQ,sBAAsB;AACzD,SAASC,UAAU,QAAQ,cAAc;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1C,OAAO,MAAMC,iBAAiB,gBAAGX,aAAa,CAAC,CAAC;AAChD,OAAO,MAAMY,oBAAoB,gBAAGZ,aAAa,CAAC,CAAC;AAEnD,OAAO,MAAMa,aAAa,GAAGA,CAAA;EAAAC,EAAA;EAAA,OAAMb,UAAU,CAACU,iBAAiB,CAAC;AAAA;AAACG,EAAA,CAApDD,aAAa;AAC1B,OAAO,MAAME,gBAAgB,GAAGA,CAAA;EAAAC,GAAA;EAAA,OAAMf,UAAU,CAACW,oBAAoB,CAAC;AAAA;AAACI,GAAA,CAA1DD,gBAAgB;AAE7B,OAAO,MAAME,kBAAkB,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,GAAA;EAClD,MAAM,CAACC,UAAU,EAAEC,aAAa,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAClD,MAAMkB,OAAO,GAAGd,UAAU,CAAC,CAAC;EAE5B,MAAMe,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,IAAI;MACF,MAAM;QAAEC;MAAK,CAAC,GAAG,MAAMjB,QAAQ,CAACkB,GAAG,CAAC,oBAAoB,CAAC;MACzDJ,aAAa,CAACG,IAAI,CAAC;IACrB,CAAC,CAAC,OAAOE,GAAG,EAAE;MACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;IAClB;EACF,CAAC;EAEDxB,SAAS,CAAC,MAAM;IACdqB,WAAW,CAAC,CAAC;EACf,CAAC,EAAE,EAAE,CAAC;EAENpB,OAAO,CAAC,MAAM;IACZG,QAAQ,CAACuB,YAAY,CAACC,OAAO,CAACC,GAAG,CAC/B,MAAOC,MAAM,IAAK;MAChB,IAAI;QACF,MAAM3B,KAAK,CAAC4B,IAAI,CAAC,8BAA8B,CAAC;MAClD,CAAC,CAAC,OAAOP,GAAG,EAAE;QACZL,aAAa,CAAEa,cAAc,IAAK;UAChC,IAAIA,cAAc,EAAE;YAClBZ,OAAO,CAACa,IAAI,CAAC,SAAS,CAAC;UACzB;UACA,OAAO,IAAI;QACb,CAAC,CAAC;QACF,OAAOH,MAAM;MACf;MACA,OAAOA,MAAM;IACf,CAAC,EACAN,GAAG,IAAK;MACP,OAAOU,OAAO,CAACC,MAAM,CAACX,GAAG,CAAC;IAC5B,CACF,CAAC;IAEDnB,QAAQ,CAACsB,YAAY,CAACS,QAAQ,CAACP,GAAG,CAC/BO,QAAQ,IAAKA,QAAQ,EACtB,MAAOZ,GAAG,IAAK;MAAA,IAAAa,aAAA;MACb,IAAI,EAAAA,aAAA,GAAAb,GAAG,CAACY,QAAQ,cAAAC,aAAA,uBAAZA,aAAA,CAAcC,MAAM,MAAK,GAAG,EAAE;QAChC,IAAI;UACF,MAAMnC,KAAK,CAAC4B,IAAI,CAAC,8BAA8B,CAAC;QAClD,CAAC,CAAC,OAAOP,GAAG,EAAE;UACZL,aAAa,CAAEa,cAAc,IAAK;YAChC,IAAIA,cAAc,EAAE;cAClBZ,OAAO,CAACa,IAAI,CAAC,SAAS,CAAC;YACzB;YACA,OAAO,IAAI;UACb,CAAC,CAAC;QACJ;QACA,OAAO9B,KAAK,CAACqB,GAAG,CAACM,MAAM,CAAC;MAC1B;MACA,OAAOI,OAAO,CAACC,MAAM,CAACX,GAAG,CAAC;IAC5B,CACF,CAAC;EACH,CAAC,EAAE,CAACJ,OAAO,CAAC,CAAC;EAEb,oBACEZ,OAAA,CAACC,iBAAiB,CAAC8B,QAAQ;IAACC,KAAK,EAAEtB,UAAW;IAAAF,QAAA,eAC5CR,OAAA,CAACE,oBAAoB,CAAC6B,QAAQ;MAACC,KAAK,EAAErB,aAAc;MAAAH,QAAA,EACjDA;IAAQ;MAAAyB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACoB;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACN,CAAC;AAEjC,CAAC;AAAC3B,GAAA,CAlEWF,kBAAkB;EAAA,QAEbT,UAAU;AAAA;AAAAuC,EAAA,GAFf9B,kBAAkB;AAAA,IAAA8B,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module"}