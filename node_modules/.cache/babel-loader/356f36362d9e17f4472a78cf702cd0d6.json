{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/taskpro_api/taskpro_ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/workspace/taskpro_api/taskpro_ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/workspace/taskpro_api/taskpro_ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/**\n * Code duplicated from https://github.com/mr-fibonacci/moments/blob/a981c39da1671a70023a3d6f3cf1410164e84e06/src/contexts/CurrentUserContext.js \n */import{createContext,useContext,useEffect,useMemo,useState}from\"react\";import axios from\"axios\";import{axiosReq,axiosRes}from\"../api/axiosDefaults\";import{useHistory}from\"react-router\";import{jsx as _jsx}from\"react/jsx-runtime\";export var ActiveUserContext=/*#__PURE__*/createContext();export var SetActiveUserContext=/*#__PURE__*/createContext();export var useActiveUser=function useActiveUser(){return useContext(ActiveUserContext);};export var useSetActiveUser=function useSetActiveUser(){return useContext(SetActiveUserContext);};export var ActiveUserProvider=function ActiveUserProvider(_ref){var children=_ref.children;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),activeUser=_useState2[0],setActiveUser=_useState2[1];var history=useHistory();var handleMount=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axiosRes$get,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axiosRes.get(\"dj-rest-auth/user/\");case 3:_yield$axiosRes$get=_context.sent;data=_yield$axiosRes$get.data;setActiveUser(data);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function handleMount(){return _ref2.apply(this,arguments);};}();useEffect(function(){handleMount();},[]);useMemo(function(){axiosReq.interceptors.request.use(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(config){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"/dj-rest-auth/token/refresh/\");case 3:_context2.next=9;break;case 5:_context2.prev=5;_context2.t0=_context2[\"catch\"](0);setActiveUser(function(prevActiveUser){if(prevActiveUser){history.push(\"/signin\");}return null;});return _context2.abrupt(\"return\",config);case 9:return _context2.abrupt(\"return\",config);case 10:case\"end\":return _context2.stop();}},_callee2,null,[[0,5]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),function(err){return Promise.reject(err);});axiosRes.interceptors.response.use(function(response){return response;},/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(err){var _err$response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(!(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401)){_context3.next=10;break;}_context3.prev=1;_context3.next=4;return axios.post(\"/dj-rest-auth/token/refresh/\");case 4:_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](1);setActiveUser(function(prevActiveUser){if(prevActiveUser){history.push(\"/signin\");}return null;});case 9:return _context3.abrupt(\"return\",axios(err.config));case 10:return _context3.abrupt(\"return\",Promise.reject(err));case 11:case\"end\":return _context3.stop();}},_callee3,null,[[1,6]]);}));return function(_x2){return _ref4.apply(this,arguments);};}());},[history]);return/*#__PURE__*/_jsx(ActiveUserContext.Provider,{value:activeUser,children:/*#__PURE__*/_jsx(SetActiveUserContext.Provider,{value:setActiveUser,children:children})});};","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","axios","axiosReq","axiosRes","useHistory","jsx","_jsx","ActiveUserContext","SetActiveUserContext","useActiveUser","useSetActiveUser","ActiveUserProvider","_ref","children","_useState","_useState2","_slicedToArray","activeUser","setActiveUser","history","handleMount","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$axiosRes$get","data","wrap","_callee$","_context","prev","next","get","sent","t0","console","log","stop","apply","arguments","interceptors","request","use","_ref3","_callee2","config","_callee2$","_context2","post","prevActiveUser","push","abrupt","_x","err","Promise","reject","response","_ref4","_callee3","_err$response","_callee3$","_context3","status","_x2","Provider","value"],"sources":["/workspace/taskpro_api/taskpro_ui/src/contexts/ActiveUserContext.js"],"sourcesContent":["/**\n * Code duplicated from https://github.com/mr-fibonacci/moments/blob/a981c39da1671a70023a3d6f3cf1410164e84e06/src/contexts/CurrentUserContext.js \n */\nimport { createContext, useContext, useEffect, useMemo, useState } from \"react\";\nimport axios from \"axios\";\nimport { axiosReq, axiosRes } from \"../api/axiosDefaults\";\nimport { useHistory } from \"react-router\";\n\nexport const ActiveUserContext = createContext();\nexport const SetActiveUserContext = createContext();\n\nexport const useActiveUser = () => useContext(ActiveUserContext);\nexport const useSetActiveUser = () => useContext(SetActiveUserContext);\n\nexport const ActiveUserProvider = ({ children }) => {\n  const [activeUser, setActiveUser] = useState(null);\n  const history = useHistory();\n\n  const handleMount = async () => {\n    try {\n      const { data } = await axiosRes.get(\"dj-rest-auth/user/\");\n      setActiveUser(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  useEffect(() => {\n    handleMount();\n  }, []);\n\n  useMemo(() => {\n    axiosReq.interceptors.request.use(\n      async (config) => {\n        try {\n          await axios.post(\"/dj-rest-auth/token/refresh/\");\n        } catch (err) {\n          setActiveUser((prevActiveUser) => {\n            if (prevActiveUser) {\n              history.push(\"/signin\");\n            }\n            return null;\n          });\n          return config;\n        }\n        return config;\n      },\n      (err) => {\n        return Promise.reject(err);\n      }\n    );\n\n    axiosRes.interceptors.response.use(\n      (response) => response,\n      async (err) => {\n        if (err.response?.status === 401) {\n          try {\n            await axios.post(\"/dj-rest-auth/token/refresh/\");\n          } catch (err) {\n            setActiveUser((prevActiveUser) => {\n              if (prevActiveUser) {\n                history.push(\"/signin\");\n              }\n              return null;\n            });\n          }\n          return axios(err.config);\n        }\n        return Promise.reject(err);\n      }\n    );\n  }, [history]);\n\n  return (\n    <ActiveUserContext.Provider value={activeUser}>\n      <SetActiveUserContext.Provider value={setActiveUser}>\n        {children}\n      </SetActiveUserContext.Provider>\n    </ActiveUserContext.Provider>\n  );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}